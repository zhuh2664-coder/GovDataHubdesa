<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>ç®€æ˜“æ¥ç åŠ©æ‰‹</title>
    <style>
        body { font-family: sans-serif; max-width: 500px; margin: 50px auto; padding: 20px; border: 1px solid #ddd; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .card { margin-bottom: 20px; }
        input, button { width: 100%; padding: 10px; margin-top: 10px; box-sizing: border-box; }
        button { background-color: #007bff; color: white; border: none; cursor: pointer; border-radius: 5px; }
        button:disabled { background-color: #ccc; }
        #log { background: #f8f9fa; padding: 10px; height: 150px; overflow-y: auto; font-size: 12px; border: 1px solid #eee; margin-top: 10px; }
        .sms-box { background: #e7f3ff; padding: 15px; border-left: 5px solid #007bff; margin-top: 20px; display: none; }
    </style>
</head>
<body>
    <h2>æ¥ç åŠ©æ‰‹</h2>
    
    <div class="card">
        <label>é¡¹ç›® ID (PID):</label>
        <input type="text" id="pid" value="1403">
        <button id="getPhoneBtn">1. è·å–æ‰‹æœºå·</button>
    </div>

    <div id="phoneDisplay" style="font-size: 1.2em; font-weight: bold; color: #d9534f; text-align: center;"></div>

    <div class="card" id="step2" style="display:none;">
        <p>å·²ç»åœ¨ App å‘é€éªŒè¯ç ï¼Ÿ</p>
        <button id="startCheckBtn" style="background-color: #28a745;">2. å¼€å§‹ç›‘å¬éªŒè¯ç </button>
    </div>

    <div id="smsResult" class="sms-box">
        <strong>éªŒè¯ç å†…å®¹ï¼š</strong>
        <div id="smsContent">ç­‰å¾…ä¸­...</div>
    </div>

    <div id="log">ç³»ç»Ÿæ—¥å¿—...</div>

    <script>
        const TOKEN = "KbVpdZ2EBWvkJwMRyX35Q9LPq0z86AYG";
        const BASE_URL = "http://api.ee2026.com";
        let currentOrderId = "";

        function log(msg) {
            const div = document.getElementById('log');
            div.innerHTML += `<div>[${new Date().toLocaleTimeString()}] ${msg}</div>`;
            div.scrollTop = div.scrollHeight;
        }

        // è·å–æ‰‹æœºå·
        document.getElementById('getPhoneBtn').onclick = async () => {
            const pid = document.getElementById('pid').value;
            log("æ­£åœ¨è·å–å·ç ...");
            try {
                const response = await fetch(`${BASE_URL}/api/sms/getPhone?token=${TOKEN}&pid=${pid}`);
                const res = await response.json();
                if(res.code === 200) {
                    currentOrderId = res.data.order_id;
                    document.getElementById('phoneDisplay').innerText = "å·ç ï¼š" + res.data.phone;
                    document.getElementById('step2').style.display = "block";
                    log("å–å·æˆåŠŸï¼š" + res.data.phone);
                } else {
                    log("å–å·å¤±è´¥ï¼š" + res.msg);
                }
            } catch (e) { log("ç½‘ç»œè¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥æµè§ˆå™¨æ˜¯å¦å…è®¸è·¨åŸŸ"); }
        };

        // ç›‘å¬éªŒè¯ç 
        document.getElementById('startCheckBtn').onclick = function() {
            this.disabled = true;
            log("å¯åŠ¨è½®è¯¢æ¨¡å¼ï¼Œæ¯10ç§’æ£€æŸ¥ä¸€æ¬¡...");
            document.getElementById('smsResult').style.display = "block";
            
            const timer = setInterval(async () => {
                try {
                    const response = await fetch(`${BASE_URL}/api/sms/getMessage?token=${TOKEN}&order_id=${currentOrderId}`);
                    const res = await response.json();
                    if(res.code === 200 && res.data.message) {
                        document.getElementById('smsContent').innerText = res.data.message;
                        log("ğŸ‰ æˆåŠŸè·å–éªŒè¯ç ï¼");
                        clearInterval(timer);
                        document.getElementById('startCheckBtn').disabled = false;
                    } else {
                        log("å°šæœªæ”¶åˆ°çŸ­ä¿¡ï¼Œç»§ç»­ç­‰å¾…...");
                    }
                } catch (e) { log("æŸ¥è¯¢å‡ºé”™"); }
            }, 10000);
        };
    </script>
</body>
</html>